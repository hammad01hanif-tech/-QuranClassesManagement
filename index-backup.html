<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>Quran Classes â€” Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: sans-serif; direction: rtl; padding: 18px; background: #f5f5f5; }
    label { display:block; margin-top:8px; }
    select, input, textarea { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; }
    .row { display:flex; gap:10px; }
    .col { flex:1; }
    .student-list { max-height:240px; overflow:auto; margin-top:8px; border:1px solid #ddd; padding:8px; background: white; }
    .student-item { padding:6px; border-bottom:1px solid #f0f0f0; }
    button { padding:8px 12px; margin-top:10px; cursor:pointer; }
    .small { font-size:0.9rem; color:#555; }
    
    /* Role Selection Page */
    .role-selection { 
      max-width: 600px; 
      margin: 100px auto; 
      text-align: center; 
      background: white; 
      padding: 40px; 
      border-radius: 10px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
    }
    .role-button { 
      display: inline-block; 
      width: 150px; 
      height: 150px; 
      margin: 15px; 
      padding: 20px; 
      background: #2d7a44; 
      color: white; 
      border: none; 
      border-radius: 10px; 
      font-size: 18px; 
      cursor: pointer; 
      transition: all 0.3s; 
    }
    .role-button:hover { background: #236035; transform: scale(1.05); }
    
    /* Admin Page */
    .admin-section { display: none; }
    .admin-header { 
      background: #2d7a44; 
      color: white; 
      padding: 15px; 
      margin: -18px -18px 20px -18px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    .logout-btn { 
      background: #dc3545; 
      color: white; 
      border: none; 
      padding: 8px 15px; 
      border-radius: 5px; 
      cursor: pointer; 
    }
    .tabs { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 20px; 
      border-bottom: 2px solid #ddd; 
    }
    .tab { 
      padding: 10px 20px; 
      background: #f0f0f0; 
      border: none; 
      cursor: pointer; 
      border-radius: 5px 5px 0 0; 
    }
    .tab.active { background: #2d7a44; color: white; }
    .tab-content { display: none; background: white; padding: 20px; border-radius: 5px; }
    .tab-content.active { display: block; }
    
    /* Reports Table */
    .reports-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .reports-table th, .reports-table td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    .reports-table th { background: #2d7a44; color: white; }
    .reports-table tr:hover { background: #f5f5f5; }
    .view-report-btn { background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    .struggle-item { background: #ffe6e6; border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .struggle-item h4 { margin: 0 0 10px 0; color: #dc3545; }
  </style>
</head>
<body>
  
  <!-- Role Selection Page -->
  <div id="roleSelection" class="role-selection">
    <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
    <p style="margin-bottom: 30px;">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ùƒ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
    <button class="role-button" onclick="selectRole('admin')">
      ğŸ‘¨â€ğŸ’¼<br>Ù…Ø¯ÙŠØ±<br>Admin
    </button>
    <button class="role-button" onclick="selectRole('teacher')">
      ğŸ‘¨â€ğŸ«<br>Ù…Ø¹Ù„Ù…<br>Teacher
    </button>
    <button class="role-button" onclick="selectRole('student')">
      ğŸ‘¨â€ğŸ“<br>Ø·Ø§Ù„Ø¨<br>Student
    </button>
  </div>

  <!-- Admin Section -->
  <div id="adminSection" class="admin-section">
    <div class="admin-header">
      <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
      <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('students')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button class="tab" onclick="switchTab('reports')">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</button>
      <button class="tab" onclick="switchTab('classes')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª</button>
    </div>

    <!-- Students Management Tab -->
    <div id="studentsTab" class="tab-content active">
      <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>

      <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>

  <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
  <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">

  <label>Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø©:</label>
  <select id="classSelectAdd">
    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option>
  </select>

  <button onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
  <p id="result"></p>

  <hr>

  <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø©</h3>
  <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ù„Ù‚Ø©:</label>
  <select id="classSelectView"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option></select>

  <div id="students" class="student-list">Ø§Ø®ØªØ± Ø­Ù„Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
    </div>

    <!-- Reports Tab -->
    <div id="reportsTab" class="tab-content">
      <h3>ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
      
      <label>Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø©:</label>
      <select id="classSelectReports"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option></select>
      
      <label>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
      <select id="studentSelectReports"><option value="">-- Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ --</option></select>
      
      <div id="reportsContainer" style="margin-top: 20px;">
        <p class="small">Ø§Ø®ØªØ± Ø­Ù„Ù‚Ø© ÙˆØ·Ø§Ù„Ø¨ Ù„Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
      </div>
    </div>

    <!-- Classes Management Tab -->
    <div id="classesTab" class="tab-content">
      <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª</h3>
      <p class="small">Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø§Øª</p>
    </div>
  </div>

  <!-- Teacher Section (Coming Soon) -->
  <div id="teacherSection" style="display:none;">
    <div class="admin-header">
      <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
      <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div style="padding: 20px;">
      <h3>Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h3>
      <select id="teacherStudentSelect" style="max-width: 400px;">
        <option value="">-- Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ --</option>
      </select>

      <div id="teacherStudentActions" style="display:none; margin-top: 20px;">
        <h4>Ø§Ù„Ø·Ø§Ù„Ø¨: <span id="selectedTeacherStudent"></span></h4>
        
        <div style="display: flex; gap: 15px; margin-top: 20px;">
          <button class="action-btn" onclick="showNewAssessment()" style="background: #28a745; color: white; padding: 15px 30px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
            â• ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯
          </button>
          <button class="action-btn" onclick="showPastReports()" style="background: #007bff; color: white; padding: 15px 30px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
            ğŸ“‹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          </button>
          <button class="action-btn" onclick="showStruggles()" style="background: #dc3545; color: white; padding: 15px 30px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
            âš ï¸ Ø§Ù„ØªØ¹Ø«Ø±Ø§Øª
          </button>
        </div>

        <!-- New Assessment Form -->
        <div id="newAssessmentForm" style="display:none; margin-top: 30px; background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
          <h3>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯</h3>

          <div class="row">
            <div class="col">
              <label>ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ± (0-5)</label>
              <input id="teacherAsrPrayerScore" type="number" min="0" max="5" value="5">
            </div>
            <div class="col">
              <label>Ø§Ù„Ø¯Ø±Ø³ (Ø¯Ø±Ø¬Ø© 0-5)</label>
              <input id="teacherLessonScore" type="number" min="0" max="5" value="5">
            </div>
          </div>

          <label>Ø¯Ø±Ø³ Ù…Ù† (Ù…Ø«Ø§Ù„: "Ø§Ù„Ø¨Ù‚Ø±Ø© 20")</label>
          <input id="teacherLessonFrom" type="text">

          <label>Ø¯Ø±Ø³ Ø¥Ù„Ù‰</label>
          <input id="teacherLessonTo" type="text">

          <label>Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³ (Ø¯Ø±Ø¬Ø© 0-5)</label>
          <input id="teacherLessonSideScore" type="number" min="0" max="5" value="5">

          <label>Ù†Øµ Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³</label>
          <input id="teacherLessonSideText" type="text">

          <label>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Ø¯Ø±Ø¬Ø© 0-5)</label>
          <input id="teacherRevisionScore" type="number" min="0" max="5" value="5">

          <label>Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù†</label>
          <input id="teacherRevisionFrom" type="text">

          <label>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ù„Ù‰</label>
          <input id="teacherRevisionTo" type="text">

          <label>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ù„Ù†Ø¸Ø± (0-5)</label>
          <input id="teacherReadingScore" type="number" min="0" max="5" value="5">

          <label>Ø§Ù„Ø³Ù„ÙˆÙƒ (0-5)</label>
          <input id="teacherBehaviorScore" type="number" min="0" max="5" value="5">

          <button onclick="saveTeacherAssessment()" style="background: #28a745; color: white; padding: 10px 20px; margin-top: 15px; border: none; border-radius: 5px; cursor: pointer;">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
          </button>
          <div id="teacherStatus" class="small" style="margin-top: 10px;"></div>
        </div>

        <!-- Past Reports -->
        <div id="pastReportsSection" style="display:none; margin-top: 30px;">
          <h3>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
          <div id="pastReportsContainer"></div>
        </div>

        <!-- Struggles Section -->
        <div id="strugglesSection" style="display:none; margin-top: 30px;">
          <h3>Ø§Ù„ØªØ¹Ø«Ø±Ø§Øª (Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ØºÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø©)</h3>
          <div id="strugglesContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Section (Coming Soon) -->
  <div id="studentSection" style="display:none;">
    <h2>ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
    <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <p>Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p>
  </div>

  <script type="module">
    // ---- Firebase v9 modular imports via CDN ----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, doc, query, where, setDoc, addDoc, serverTimestamp, orderBy, startAt, endAt, updateDoc, arrayUnion, deleteDoc, arrayRemove
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ====== Ø¶Ø¹ Ù‡Ù†Ø§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ ======
    const firebaseConfig = {
    apiKey: "AIzaSyALjuy8zAf9oiyWV3h3epsTtx0ZKSccxRo",
    authDomain: "quranclassesmanagement.firebaseapp.com",
    projectId: "quranclassesmanagement",
    storageBucket: "quranclassesmanagement.firebasestorage.app",
    messagingSenderId: "868247342998",
    appId: "1:868247342998:web:95908153b6d0f25fb8d7b7",
    measurementId: "G-F1MW3KMZGG"
};
    // =====================================
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global role selection functions
    window.selectRole = function(role) {
      document.getElementById('roleSelection').style.display = 'none';
      if (role === 'admin') {
        document.getElementById('adminSection').style.display = 'block';
        initAdmin();
      } else if (role === 'teacher') {
        document.getElementById('teacherSection').style.display = 'block';
        initTeacher();
      } else if (role === 'student') {
        document.getElementById('studentSection').style.display = 'block';
      }
    };

    window.logout = function() {
      document.getElementById('roleSelection').style.display = 'block';
      document.getElementById('adminSection').style.display = 'none';
      document.getElementById('teacherSection').style.display = 'none';
      document.getElementById('studentSection').style.display = 'none';
    };

    window.switchTab = function(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
    };

    // Admin section variables
    const classSelectAdd = document.getElementById('classSelectAdd');
    const classSelectView = document.getElementById('classSelectView');
    const classSelectReports = document.getElementById('classSelectReports');
    const studentSelectReports = document.getElementById('studentSelectReports');
    const studentsDiv = document.getElementById('students');
    const reportsContainer = document.getElementById('reportsContainer');

    // Teacher section variables
    const teacherStudentSelect = document.getElementById('teacherStudentSelect');
    const teacherStudentActions = document.getElementById('teacherStudentActions');
    const selectedTeacherStudentSpan = document.getElementById('selectedTeacherStudent');
    
    let selectedClassId = null;
    let currentTeacherStudentId = null;
    let currentTeacherStudentName = null;

    // Initialize admin section
    function initAdmin() {
      loadClasses();
    }

    // addStudent function - exposed globally
    window.addStudent = async function() {
      const name = document.getElementById("studentName").value.trim();
      const classId = document.getElementById("classSelectAdd").value;
      const result = document.getElementById("result");

      if (!name) {
        result.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨";
        return;
      }

      if (!classId) {
        result.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ù„Ù‚Ø©";
        return;
      }

      try {
        // Ù†Ø¹Ù…Ù„ userId ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ classId
        const randomNumber = Math.floor(Math.random() * 1000).toString().padStart(3, "0");
        const userId = `${classId}_${randomNumber}`;

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… setDoc Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† addDoc Ù„ØªØ­Ø¯ÙŠØ¯ document ID
        await setDoc(doc(db, "users", userId), {
          userId: userId,
          name: name,
          role: "student",
          classId: classId,
          createdAt: serverTimestamp()
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© studentIds ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø©
        const classDocRef = doc(db, "classes", classId);
        await updateDoc(classDocRef, {
          studentIds: arrayUnion(userId)
        });

        result.innerText = `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨: ${name} (${userId})`;
        result.style.color = 'green';
        document.getElementById("studentName").value = ""; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        
        // Refresh student list if same class is selected
        if (selectedClassId === classId) {
          loadStudentsForClass(classId);
        }
      } catch (error) {
        console.error("Error adding student:", error);
        result.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨: " + error.message;
        result.style.color = 'red';
      }
    };

    // load classes
    async function loadClasses() {
      classSelectAdd.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option>';
      classSelectView.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option>';
      classSelectReports.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ù„Ù‚Ø© --</option>';
      
      const snap = await getDocs(collection(db, 'classes'));
      snap.forEach(d => {
        const data = d.data();
        const cid = data.classId || d.id;
        const label = data.className || cid;
        
        // Add to all dropdowns
        const opt1 = document.createElement('option');
        opt1.value = cid;
        opt1.textContent = `${label}`;
        classSelectAdd.appendChild(opt1);
        
        const opt2 = document.createElement('option');
        opt2.value = cid;
        opt2.textContent = `${label}`;
        classSelectView.appendChild(opt2);
        
        const opt3 = document.createElement('option');
        opt3.value = cid;
        opt3.textContent = `${label}`;
        classSelectReports.appendChild(opt3);
      });
    }

    // load students for chosen class
    async function loadStudentsForClass(classId) {
      studentsDiv.innerHTML = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
      selectedClassId = classId;
      try {
        // Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø³ÙŠØ· Ø¨Ø¯ÙˆÙ† orderBy Ù„ØªØ¬Ù†Ø¨ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙÙ‡Ø±Ø³
        let q = query(collection(db, 'users'), where('classId', '==', classId));
        let snap = await getDocs(q);
        
        if (snap.empty) {
          studentsDiv.innerHTML = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…ÙØ³Ø¬Ù„ÙŠÙ† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù„Ù‚Ø©.';
          return;
        }
        
        studentsDiv.innerHTML = '';
        const students = [];
        snap.forEach(d => {
          const dt = d.data();
          const id = d.id;
          const name = dt.name || '(Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…)';
          const role = dt.role || '';
          if (role === 'student') {
            students.push({ id, name });
          }
        });
        
        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙŠØ¯ÙˆÙŠÙ‹Ø§
        students.sort((a, b) => a.id.localeCompare(b.id));
        
        students.forEach(student => {
          const div = document.createElement('div');
          div.className = 'student-item';
          div.innerHTML = `<strong>${student.id}</strong> â€” ${student.name} 
            <button data-id="${student.id}" data-name="${student.name}" class="delete-btn" style="float:left;background:#dc3545;color:white;">Ø­Ø°Ù</button>`;
          studentsDiv.appendChild(div);
          
          // Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨
          div.querySelector('.delete-btn').addEventListener('click', async (e) => {
            const studentId = e.target.dataset.id;
            const studentName = e.target.dataset.name;
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ "${studentName}" (${studentId})ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.`)) {
              await deleteStudent(studentId, studentName);
            }
          });
        });
      } catch (error) {
        console.error('Error loading students:', error);
        studentsDiv.innerHTML = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨: ' + error.message;
      }
    }

    // Ø­Ø°Ù Ø·Ø§Ù„Ø¨
    async function deleteStudent(studentId, studentName) {
      try {
        // Ø­Ø°Ù Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© users
        await deleteDoc(doc(db, 'users', studentId));
        
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† studentIds ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø©
        if (selectedClassId) {
          const classDocRef = doc(db, 'classes', selectedClassId);
          await updateDoc(classDocRef, {
            studentIds: arrayRemove(studentId)
          });
        }
        
        alert(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ "${studentName}" (${studentId}) Ø¨Ù†Ø¬Ø§Ø­`);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
        if (selectedClassId) {
          loadStudentsForClass(selectedClassId);
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: ' + error.message);
      }
    }

    // Load students for reports tab
    async function loadStudentsForReports(classId) {
      studentSelectReports.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ --</option>';
      reportsContainer.innerHTML = '<p class="small">Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ Ù„Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ±Ù‡</p>';
      
      try {
        let q = query(collection(db, 'users'), where('classId', '==', classId), where('role', '==', 'student'));
        let snap = await getDocs(q);
        
        if (snap.empty) {
          studentSelectReports.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</option>';
          return;
        }
        
        const students = [];
        snap.forEach(d => {
          const dt = d.data();
          students.push({ id: d.id, name: dt.name || '(Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…)' });
        });
        
        students.sort((a, b) => a.id.localeCompare(b.id));
        
        students.forEach(student => {
          const opt = document.createElement('option');
          opt.value = student.id;
          opt.textContent = `${student.id} â€” ${student.name}`;
          studentSelectReports.appendChild(opt);
        });
      } catch (error) {
        console.error('Error loading students:', error);
        studentSelectReports.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
      }
    }

    // Load reports for selected student
    async function loadReportsForStudent(studentId) {
      reportsContainer.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...</p>';
      
      try {
        const reportsSnap = await getDocs(collection(db, 'studentProgress', studentId, 'dailyReports'));
        
        if (reportsSnap.empty) {
          reportsContainer.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨</p>';
          return;
        }
        
        const reports = [];
        reportsSnap.forEach(d => {
          reports.push({ dateId: d.id, ...d.data() });
        });
        
        // Sort by date descending
        reports.sort((a, b) => b.dateId.localeCompare(a.dateId));
        
        // Create table
        let tableHTML = `
          <table class="reports-table">
            <thead>
              <tr>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>Ø§Ù„ÙŠÙˆÙ…</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±</th>
                <th>Ø§Ù„Ø¯Ø±Ø³</th>
                <th>Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³</th>
                <th>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</th>
                <th>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</th>
                <th>Ø§Ù„Ø³Ù„ÙˆÙƒ</th>
                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        reports.forEach(report => {
          const date = new Date(report.dateId);
          const dayName = date.toLocaleDateString('ar-EG', { weekday: 'long' });
          
          tableHTML += `
            <tr>
              <td>${report.dateId}</td>
              <td>${dayName}</td>
              <td><strong>${report.totalScore || 0}</strong></td>
              <td>${report.asrPrayerScore || 0}</td>
              <td>${report.lessonScore || 0}</td>
              <td>${report.lessonSideScore || 0}</td>
              <td>${report.revisionScore || 0}</td>
              <td>${report.readingScore || 0}</td>
              <td>${report.behaviorScore || 0}</td>
              <td><button class="view-report-btn" onclick="viewReportDetails('${report.dateId}', ${JSON.stringify(report).replace(/"/g, '&quot;')})">Ø¹Ø±Ø¶</button></td>
            </tr>
          `;
        });
        
        tableHTML += `
            </tbody>
          </table>
        `;
        
        reportsContainer.innerHTML = `<h4>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© (${reports.length} ØªÙ‚Ø±ÙŠØ±)</h4>` + tableHTML;
      } catch (error) {
        console.error('Error loading reports:', error);
        reportsContainer.innerHTML = '<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±: ' + error.message + '</p>';
      }
    }

    // View report details
    window.viewReportDetails = function(dateId, report) {
      const details = `
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateId}
Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${report.studentName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${report.studentId || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}

=== Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ===
ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±: ${report.asrPrayerScore || 0}/5
Ø§Ù„Ø¯Ø±Ø³: ${report.lessonScore || 0}/5 (Ù…Ù† ${report.lessonFrom || '-'} Ø¥Ù„Ù‰ ${report.lessonTo || '-'})
Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³: ${report.lessonSideScore || 0}/5 (${report.lessonSideText || '-'})
Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: ${report.revisionScore || 0}/5 (Ù…Ù† ${report.revisionFrom || '-'} Ø¥Ù„Ù‰ ${report.revisionTo || '-'})
Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ù„Ù†Ø¸Ø±: ${report.readingScore || 0}/5
Ø§Ù„Ø³Ù„ÙˆÙƒ: ${report.behaviorScore || 0}/5

Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${report.totalScore || 0}/30
      `;
      alert(details);
    };

    // Event listeners for reports tab
    classSelectReports.addEventListener('change', (e) => {
      const cid = e.target.value;
      if (!cid) {
        studentSelectReports.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ --</option>';
        reportsContainer.innerHTML = '<p class="small">Ø§Ø®ØªØ± Ø­Ù„Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹</p>';
        return;
      }
      loadStudentsForReports(cid);
    });

    studentSelectReports.addEventListener('change', (e) => {
      const sid = e.target.value;
      if (!sid) {
        reportsContainer.innerHTML = '<p class="small">Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ Ù„Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ±Ù‡</p>';
        return;
      }
      loadReportsForStudent(sid);
    });

    // events
    classSelectView.addEventListener('change', (e) => {
      const cid = e.target.value;
      if (!cid) { studentsDiv.innerHTML = 'Ø§Ø®ØªØ± Ø­Ù„Ù‚Ø©.'; return; }
      loadStudentsForClass(cid);
    });

    // ========== TEACHER SECTION ==========
    
    // Initialize teacher section
    function initTeacher() {
      loadTeacherStudents();
    }

    // Load all students for teacher (in real app, filter by teacher's classId)
    async function loadTeacherStudents() {
      teacherStudentSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ --</option>';
      
      try {
        // For now, load all students. In production, filter by teacher's classId
        let q = query(collection(db, 'users'), where('role', '==', 'student'));
        let snap = await getDocs(q);
        
        if (snap.empty) {
          teacherStudentSelect.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</option>';
          return;
        }
        
        const students = [];
        snap.forEach(d => {
          const dt = d.data();
          students.push({ id: d.id, name: dt.name || '(Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…)' });
        });
        
        students.sort((a, b) => a.id.localeCompare(b.id));
        
        students.forEach(student => {
          const opt = document.createElement('option');
          opt.value = student.id;
          opt.textContent = `${student.id} â€” ${student.name}`;
          teacherStudentSelect.appendChild(opt);
        });
      } catch (error) {
        console.error('Error loading students:', error);
      }
    }

    // Teacher student selection event
    teacherStudentSelect.addEventListener('change', (e) => {
      const studentId = e.target.value;
      if (!studentId) {
        teacherStudentActions.style.display = 'none';
        return;
      }
      
      const selectedOption = e.target.options[e.target.selectedIndex];
      const studentText = selectedOption.textContent;
      
      currentTeacherStudentId = studentId;
      currentTeacherStudentName = studentText.split(' â€” ')[1] || studentId;
      
      selectedTeacherStudentSpan.textContent = studentText;
      teacherStudentActions.style.display = 'block';
      
      // Hide all sections
      document.getElementById('newAssessmentForm').style.display = 'none';
      document.getElementById('pastReportsSection').style.display = 'none';
      document.getElementById('strugglesSection').style.display = 'none';
    });

    // Show new assessment form
    window.showNewAssessment = function() {
      document.getElementById('newAssessmentForm').style.display = 'block';
      document.getElementById('pastReportsSection').style.display = 'none';
      document.getElementById('strugglesSection').style.display = 'none';
      
      // Reset form
      document.getElementById('teacherAsrPrayerScore').value = 5;
      document.getElementById('teacherLessonScore').value = 5;
      document.getElementById('teacherLessonFrom').value = '';
      document.getElementById('teacherLessonTo').value = '';
      document.getElementById('teacherLessonSideScore').value = 5;
      document.getElementById('teacherLessonSideText').value = '';
      document.getElementById('teacherRevisionScore').value = 5;
      document.getElementById('teacherRevisionFrom').value = '';
      document.getElementById('teacherRevisionTo').value = '';
      document.getElementById('teacherReadingScore').value = 5;
      document.getElementById('teacherBehaviorScore').value = 5;
      document.getElementById('teacherStatus').textContent = '';
    };

    // Save teacher assessment
    window.saveTeacherAssessment = async function() {
      if (!currentTeacherStudentId) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨');
        return;
      }
      
      const statusDiv = document.getElementById('teacherStatus');
      statusDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      statusDiv.style.color = 'blue';
      
      const data = {
        studentId: currentTeacherStudentId,
        studentName: currentTeacherStudentName,
        asrPrayerScore: Number(document.getElementById('teacherAsrPrayerScore').value) || 0,
        lessonScore: Number(document.getElementById('teacherLessonScore').value) || 0,
        lessonFrom: (document.getElementById('teacherLessonFrom').value || '').trim(),
        lessonTo: (document.getElementById('teacherLessonTo').value || '').trim(),
        lessonSideScore: Number(document.getElementById('teacherLessonSideScore').value) || 0,
        lessonSideText: (document.getElementById('teacherLessonSideText').value || '').trim(),
        revisionScore: Number(document.getElementById('teacherRevisionScore').value) || 0,
        revisionFrom: (document.getElementById('teacherRevisionFrom').value || '').trim(),
        revisionTo: (document.getElementById('teacherRevisionTo').value || '').trim(),
        readingScore: Number(document.getElementById('teacherReadingScore').value) || 0,
        behaviorScore: Number(document.getElementById('teacherBehaviorScore').value) || 0
      };
      
      // Calculate total
      data.totalScore = data.asrPrayerScore + data.lessonScore + data.lessonSideScore
                      + data.revisionScore + data.readingScore + data.behaviorScore;
      
      // Check completeness
      const missing = [];
      if (!data.lessonFrom || !data.lessonTo) missing.push('lesson');
      if (!data.revisionFrom || !data.revisionTo) missing.push('revision');
      if (!data.lessonSideText) missing.push('lessonSide');
      data.missingFields = missing;
      data.isComplete = missing.length === 0;
      data.date = serverTimestamp();
      
      // Get today's date
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth()+1).padStart(2,'0');
      const d = String(today.getDate()).padStart(2,'0');
      const dateId = `${y}-${m}-${d}`;
      
      try {
        const targetDoc = doc(db, 'studentProgress', currentTeacherStudentId, 'dailyReports', dateId);
        await setDoc(targetDoc, data);
        statusDiv.textContent = `âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­ â€” Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${data.totalScore}/30`;
        statusDiv.style.color = 'green';
        
        // Clear form after 2 seconds
        setTimeout(() => {
          showNewAssessment();
        }, 2000);
      } catch (error) {
        console.error('Error saving assessment:', error);
        statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ' + error.message;
        statusDiv.style.color = 'red';
      }
    };

    // Show past reports
    window.showPastReports = async function() {
      document.getElementById('newAssessmentForm').style.display = 'none';
      document.getElementById('pastReportsSection').style.display = 'block';
      document.getElementById('strugglesSection').style.display = 'none';
      
      const container = document.getElementById('pastReportsContainer');
      container.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...</p>';
      
      try {
        const reportsSnap = await getDocs(collection(db, 'studentProgress', currentTeacherStudentId, 'dailyReports'));
        
        if (reportsSnap.empty) {
          container.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨</p>';
          return;
        }
        
        const reports = [];
        reportsSnap.forEach(d => {
          reports.push({ dateId: d.id, ...d.data() });
        });
        
        reports.sort((a, b) => b.dateId.localeCompare(a.dateId));
        
        let tableHTML = `
          <table class="reports-table">
            <thead>
              <tr>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>Ø§Ù„ÙŠÙˆÙ…</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±</th>
                <th>Ø§Ù„Ø¯Ø±Ø³</th>
                <th>Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³</th>
                <th>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</th>
                <th>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</th>
                <th>Ø§Ù„Ø³Ù„ÙˆÙƒ</th>
                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        reports.forEach(report => {
          const date = new Date(report.dateId);
          const dayName = date.toLocaleDateString('ar-EG', { weekday: 'long' });
          
          tableHTML += `
            <tr>
              <td>${report.dateId}</td>
              <td>${dayName}</td>
              <td><strong>${report.totalScore || 0}</strong></td>
              <td>${report.asrPrayerScore || 0}</td>
              <td>${report.lessonScore || 0}</td>
              <td>${report.lessonSideScore || 0}</td>
              <td>${report.revisionScore || 0}</td>
              <td>${report.readingScore || 0}</td>
              <td>${report.behaviorScore || 0}</td>
              <td><button class="view-report-btn" onclick="viewReportDetails('${report.dateId}', ${JSON.stringify(report).replace(/"/g, '&quot;')})">Ø¹Ø±Ø¶</button></td>
            </tr>
          `;
        });
        
        tableHTML += '</tbody></table>';
        container.innerHTML = `<h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±: ${reports.length}</h4>` + tableHTML;
      } catch (error) {
        console.error('Error loading reports:', error);
        container.innerHTML = '<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</p>';
      }
    };

    // Show struggles (incomplete scores)
    window.showStruggles = async function() {
      document.getElementById('newAssessmentForm').style.display = 'none';
      document.getElementById('pastReportsSection').style.display = 'none';
      document.getElementById('strugglesSection').style.display = 'block';
      
      const container = document.getElementById('strugglesContainer');
      container.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ø«Ø±Ø§Øª...</p>';
      
      try {
        const reportsSnap = await getDocs(collection(db, 'studentProgress', currentTeacherStudentId, 'dailyReports'));
        
        if (reportsSnap.empty) {
          container.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨</p>';
          return;
        }
        
        const struggles = [];
        reportsSnap.forEach(d => {
          const report = { dateId: d.id, ...d.data() };
          
          // Check if any score is less than 5
          if (report.lessonScore < 5 || report.lessonSideScore < 5 || report.revisionScore < 5) {
            struggles.push(report);
          }
        });
        
        if (struggles.length === 0) {
          container.innerHTML = '<p style="color: green;">âœ… Ù…Ù…ØªØ§Ø²! Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø«Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨</p>';
          return;
        }
        
        struggles.sort((a, b) => b.dateId.localeCompare(a.dateId));
        
        let html = `<p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ Ø¨Ù‡Ø§ ØªØ¹Ø«Ø±Ø§Øª: ${struggles.length}</strong></p>`;
        
        struggles.forEach(report => {
          const date = new Date(report.dateId);
          const dayName = date.toLocaleDateString('ar-EG', { weekday: 'long' });
          
          html += `
            <div class="struggle-item">
              <h4>ğŸ“… ${report.dateId} (${dayName})</h4>
          `;
          
          if (report.lessonScore < 5) {
            html += `<p>âŒ <strong>Ø§Ù„Ø¯Ø±Ø³:</strong> ${report.lessonScore}/5 â€” Ù…Ù† ${report.lessonFrom || '-'} Ø¥Ù„Ù‰ ${report.lessonTo || '-'}</p>`;
          }
          
          if (report.lessonSideScore < 5) {
            html += `<p>âŒ <strong>Ø¬Ù†Ø¨ Ø§Ù„Ø¯Ø±Ø³:</strong> ${report.lessonSideScore}/5 â€” ${report.lessonSideText || '-'}</p>`;
          }
          
          if (report.revisionScore < 5) {
            html += `<p>âŒ <strong>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:</strong> ${report.revisionScore}/5 â€” Ù…Ù† ${report.revisionFrom || '-'} Ø¥Ù„Ù‰ ${report.revisionTo || '-'}</p>`;
          }
          
          html += `<p class="small"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</strong> ${report.totalScore || 0}/30</p>`;
          html += '</div>';
        });
        
        container.innerHTML = html;
      } catch (error) {
        console.error('Error loading struggles:', error);
        container.innerHTML = '<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ø«Ø±Ø§Øª</p>';
      }
    };

  </script>
</body>
</html>
